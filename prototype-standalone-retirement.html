<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>State Street Retirement Services</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lab+Antiqua:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            height: 100%;
            height: 100svh;
            height: 100dvh;
            height: -webkit-fill-available;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: "Inter", Arial, "sans-serif";
            font-weight: 300;
            margin: 0;
            padding: 0;
            background: #F7F9FC;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: rgb(2, 11, 91);
            min-height: 100%;
            min-height: 100svh;
            min-height: 100dvh;
            min-height: -webkit-fill-available;
            height: auto;
            overflow-x: hidden;
            overscroll-behavior-y: contain;
            touch-action: pan-y;
        }
        
        p, span, div, button, input, textarea, label, a, li, td, th {
            font-family: "Inter", Arial, "sans-serif";
            font-weight: 300;
        }
        
        .app-header-title {
            font-family: 'Lab Antiqua', serif !important;
            font-weight: 600;
            color: rgb(0, 26, 255);
        }
        
        #app {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: #F7F9FC;
            min-height: 100svh;
            min-height: 100dvh;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Responsive Breakpoints */
        @media (min-width: 768px) {
            #app {
                max-width: 100%;
            }
        }
        
        @media (min-width: 1024px) {
            #app {
                max-width: 1440px;
            }
        }
        
        /* Utility Classes */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .gap-8 { gap: 32px; }
        
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .max-w-sm { max-width: 384px; }
        .max-w-md { max-width: 448px; }
        .max-w-lg { max-width: 512px; }
        .max-w-xl { max-width: 576px; }
        .max-w-2xl { max-width: 672px; }
        .max-w-4xl { max-width: 896px; }
        .max-w-6xl { max-width: 1152px; }
        .ml-auto { margin-left: auto; }
        
        .px-2 { padding-left: 8px; padding-right: 8px; }
        .px-3 { padding-left: 12px; padding-right: 12px; }
        .px-4 { padding-left: 16px; padding-right: 16px; }
        .px-6 { padding-left: 24px; padding-right: 24px; }
        .px-8 { padding-left: 32px; padding-right: 32px; }
        
        .py-2 { padding-top: 8px; padding-bottom: 8px; }
        .py-3 { padding-top: 12px; padding-bottom: 12px; }
        .py-4 { padding-top: 16px; padding-bottom: 16px; }
        .py-6 { padding-top: 24px; padding-bottom: 24px; }
        .py-8 { padding-top: 32px; padding-bottom: 32px; }
        
        .p-2 { padding: 8px; }
        .p-4 { padding: 16px; }
        .p-6 { padding: 24px; }
        
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mb-8 { margin-bottom: 32px; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mt-6 { margin-top: 24px; }
        
        .text-xs { font-size: 12px; line-height: 1.4; }
        .text-sm { font-size: 14px; line-height: 1.5; }
        .text-base { font-size: 16px; line-height: 1.5; }
        .text-lg { font-size: 18px; line-height: 1.3; font-weight: 600; }
        .text-xl { font-size: 20px; line-height: 1.3; }
        .text-2xl { font-size: 24px; line-height: 1.2; font-weight: 700; }
        .text-3xl { font-size: 30px; line-height: 1.1; font-weight: 700; }
        .text-4xl { font-size: 36px; line-height: 1.1; font-weight: 700; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .whitespace-pre-wrap { white-space: pre-wrap; }
        
        .rounded { border-radius: 0; }
        .rounded-lg { border-radius: 0; }
        .rounded-xl { border-radius: 0; }
        .rounded-2xl { border-radius: 0; }
        .rounded-full { border-radius: 50%; }
        
        .border { border-width: 1px; border-style: solid; }
        .border-2 { border-width: 2px; border-style: solid; }
        .border-t { border-top-width: 1px; border-top-style: solid; }
        .border-b { border-bottom-width: 1px; border-bottom-style: solid; }
        
        .bg-white { background-color: #FFFFFF; }
        .bg-gray-50 { background-color: #F9FAFB; }
        .bg-gray-100 { background-color: #F3F4F6; }
        .bg-gray-200 { background-color: #E5E7EB; }
        .bg-blue-50 { background-color: #EFF6FF; }
        .bg-blue-100 { background-color: #DBEAFE; }
        .bg-primary { background-color: #0A2540; }
        .bg-secondary { background-color: #0619f5; }
        .bg-success { background-color: #30B566; }
        .bg-warning { background-color: #F5A623; }
        .bg-danger { background-color: #E25950; }
        
        .text-white { color: #FFFFFF; }
        .text-dark-navy { color: rgb(2, 11, 91); }
        .text-gray-400 { color: #9CA3AF; }
        .text-gray-600 { color: #4B5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563EB; }
        .text-blue-700 { color: #1D4ED8; }
        .text-green-600 { color: #10B981; }
        .text-green-700 { color: #059669; }
        .text-red-600 { color: #DC2626; }
        
        .border-gray-200 { border-color: #E2E8F0; }
        .border-gray-300 { border-color: #D1D5DB; }
        .border-blue-200 { border-color: #BFDBFE; }
        
        .opacity-50 { opacity: 0.5; }
        .opacity-70 { opacity: 0.7; }
        .opacity-90 { opacity: 0.9; }
        
        .hover\:bg-gray-50:hover { background-color: #F9FAFB; }
        .hover\:bg-blue-50:hover { background-color: #EFF6FF; }
        .transition-colors { transition: background-color 0.2s, color 0.2s; }
        .transition-all { transition: all 0.2s; }
        
        .sticky { position: sticky; top: 0; z-index: 100; background: white; }
        .fixed { position: fixed; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        
        .top-0 { top: 0; }
        .bottom-0 { bottom: 0; }
        .left-0 { left: 0; }
        .right-0 { right: 0; }
        
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .z-100 { z-index: 100; }
        
        .overflow-y-auto { overflow-y: auto; }
        .overflow-hidden { overflow: hidden; }
        .flex-shrink-0 { flex-shrink: 0; }
        .flex-1 { flex: 1; }
        .flex-wrap { flex-wrap: wrap; }
        
        .cursor-pointer { cursor: pointer; }
        .disabled { opacity: 0.5; cursor: not-allowed; }
        .hidden { display: none !important; }
        
        /* Persona-specific text sizing */
        [data-persona="boomer-transitioner"] {
            --text-size-base: 18px;
        }
        
        [data-persona="boomer-transitioner"] .text-base {
            font-size: 18px;
        }
        
        /* Header */
        .app-header {
            background: white;
            border-bottom: 1px solid #E2E8F0;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            position: -webkit-sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .header-logo {
            height: 72px;
            display: flex;
            align-items: center;
        }
        
        .header-logo img {
            height: 100%;
            width: auto;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .avatar-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #0619f5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 60px);
        }
        
        /* Sidebar (Desktop) */
        .sidebar {
            display: none;
            width: 240px;
            background: white;
            border-right: 1px solid #E2E8F0;
            padding: 24px 16px;
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                display: block;
            }
        }
        
        .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            cursor: pointer;
            border-radius: 0;
            transition: background 0.2s;
        }
        
        .nav-item:hover {
            background: #F3F4F6;
        }
        
        .nav-item.active {
            background: #EFF6FF;
            color: #2563EB;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 24px;
            max-width: 100%;
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
        }
        
        /* Dashboard Cards */
        .dashboard-card {
            background: white;
            border: 1px solid #E2E8F0;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #E2E8F0;
            padding: 20px;
            border-radius: 0;
            flex: 1;
            min-width: 200px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: rgb(2, 11, 91);
            margin: 8px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-change {
            font-size: 14px;
            margin-top: 4px;
        }
        
        .stat-change.positive {
            color: #10B981;
        }
        
        .stat-change.negative {
            color: #DC2626;
        }
        
        /* Investment Allocation */
        .investment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .investment-item:last-child {
            border-bottom: none;
        }
        
        .investment-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .investment-bar-fill {
            height: 100%;
            background: #0619f5;
            transition: width 0.3s;
        }
        
        /* Chatbot */
        .chatbot-container {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100%;
            max-width: 420px;
            height: 600px;
            max-height: 80vh;
            background: white;
            border: 1px solid #E2E8F0;
            border-bottom: none;
            display: none;
            flex-direction: column;
            z-index: 1000;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .chatbot-container.open {
            display: flex;
        }
        
        @media (max-width: 768px) {
            .chatbot-container {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                top: 0;
                left: 0;
            }
        }
        
        .chatbot-header {
            padding: 16px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
        }
        
        .chatbot-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .chatbot-close {
            width: 32px;
            height: 32px;
            border: none;
            background: #F3F4F6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
        }
        
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            display: flex;
            gap: 8px;
            max-width: 85%;
            animation: fadeInUp 0.3s ease-out;
        }
        
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message.ai {
            align-self: flex-start;
        }
        
        .message-content-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #0619f5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: #0A2540;
        }
        
        .message-content {
            background: #F3F4F6;
            padding: 12px 16px;
            border-radius: 0;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: #0619f5;
            color: white;
        }
        
        .message.ai .message-content {
            background: #F3F4F6;
            color: rgb(2, 11, 91);
        }
        
        /* Quick Replies */
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
            width: 100%;
        }
        
        .quick-reply-btn {
            background: white;
            border: 1px solid #E2E8F0;
            padding: 8px 16px;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            touch-action: manipulation;
            min-height: 44px;
        }
        
        .quick-reply-btn:hover {
            background: #F3F4F6;
            border-color: #0619f5;
        }
        
        /* Rich Cards */
        .message-card {
            background: white;
            border: 1px solid #E2E8F0;
            padding: 16px;
            margin-top: 8px;
            border-radius: 0;
        }
        
        .card-title {
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .card-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .card-row:last-child {
            border-bottom: none;
        }
        
        /* Chat Input */
        .chatbot-input-container {
            padding: 16px;
            border-top: 1px solid #E2E8F0;
            background: white;
        }
        
        .chatbot-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .chatbot-input {
            flex: 1;
            border: 1px solid #E2E8F0;
            padding: 12px 16px;
            border-radius: 0;
            font-size: 16px;
            font-family: inherit;
        }
        
        .chatbot-input:focus {
            outline: none;
            border-color: #0619f5;
        }
        
        .chatbot-send {
            width: 44px;
            height: 44px;
            background: #0619f5;
            color: white;
            border: none;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            touch-action: manipulation;
        }
        
        .chatbot-send:hover {
            background: #0515d4;
        }
        
        /* End of Demo Modal */
        .demo-end-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .demo-end-modal.open {
            display: flex;
        }
        
        .demo-end-modal-content {
            background: white;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border-radius: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .demo-end-modal-content h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: rgb(2, 11, 91);
            font-family: 'Lab Antiqua', serif;
        }
        
        .demo-end-modal-content p {
            font-size: 16px;
            color: rgb(2, 11, 91);
            margin-bottom: 24px;
            font-weight: 300;
        }
        
        .demo-end-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .demo-end-modal-button {
            padding: 12px 24px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 0;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .demo-end-modal-button.restart {
            background: #0619f5;
            color: white;
        }
        
        .demo-end-modal-button.restart:hover {
            background: #050dd9;
        }
        
        .demo-end-modal-button.close {
            background: #E2E8F0;
            color: rgb(2, 11, 91);
        }
        
        .demo-end-modal-button.close:hover {
            background: #CBD5E0;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #9CA3AF;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .typing-cursor {
            display: inline-block;
            animation: blink 1s infinite;
            margin-left: 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Floating Chat Button */
        .chat-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: #0619f5;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 999;
            touch-action: manipulation;
        }
        
        .chat-button:hover {
            background: #0515d4;
        }
        
        @media (max-width: 768px) {
            .chat-button {
                bottom: 80px;
            }
        }
        
        /* Persona Switcher */
        .persona-switcher {
            background: white;
            border: 1px solid #E2E8F0;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 0;
        }
        
        .persona-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        @media (max-width: 768px) {
            .persona-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .persona-card {
            border: 2px solid #E2E8F0;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 0;
            text-align: center;
        }
        
        .persona-card:hover {
            border-color: #0619f5;
            background: #F9FAFB;
        }
        
        .persona-card.active {
            border-color: #0619f5;
            background: #EFF6FF;
        }
        
        .persona-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: #0619f5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 24px;
            margin: 0 auto 12px;
        }
        
        .persona-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .persona-meta {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 8px;
        }
        
        .persona-balance {
            font-size: 18px;
            font-weight: 700;
            color: #0A2540;
        }
        
        /* Bottom Navigation (Mobile) */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #E2E8F0;
            padding: 8px 0;
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            .bottom-nav {
                display: flex;
                justify-content: space-around;
            }
        }
        
        .nav-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            border: none;
            background: none;
            cursor: pointer;
            color: #6B7280;
            font-size: 12px;
            touch-action: manipulation;
        }
        
        .nav-button.active {
            color: #0619f5;
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Activity List */
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-type {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .activity-date {
            font-size: 12px;
            color: #6B7280;
        }
        
        .activity-amount {
            font-weight: 600;
            color: #10B981;
        }
        
        .activity-amount.negative {
            color: #DC2626;
        }
        
        /* User Dropdown */
        .user-dropdown-container {
            position: relative;
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 0;
            min-width: 200px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .user-dropdown-menu.open {
            display: block;
        }
        
        .user-dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .user-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .user-dropdown-item:hover {
            background: #F9FAFB;
        }
        
        .user-dropdown-item.active {
            background: #EFF6FF;
            font-weight: 600;
        }
        
        button {
            border: none;
            background: none;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: inherit;
        }
        
        input, textarea {
            font-family: inherit;
        }
        
        input[type="text"] {
            font-size: 16px;
            touch-action: manipulation;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-logo">
                <img src="State-Street-Logo-New-529182430.png" alt="State Street">
            </div>
            <div class="header-actions">
                <div class="avatar-circle" id="userAvatar">D</div>
            </div>
        </header>

        <!-- Dashboard Container -->
        <div class="dashboard-container">
            <!-- Sidebar (Desktop) -->
            <aside class="sidebar">
                <nav>
                    <div class="nav-item active">Dashboard</div>
                    <div class="nav-item">Investments</div>
                    <div class="nav-item">Transactions</div>
                    <div class="nav-item">Documents</div>
                    <div class="nav-item">Profile</div>
                    <div class="nav-item" onclick="openChatbot()">Help</div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Content -->
                <div id="dashboardContent">
                    <!-- Welcome Section -->
                    <div class="dashboard-card">
                        <h1 class="text-2xl mb-4">Welcome back, <span id="userName">David Martinez</span> <span style="font-size: 0.75em; font-weight: 400; color: #6B7280;">(Gen X Catch-Up Persona)</span></h1>
                        <p class="text-gray-600">Here's an overview of your retirement account.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Balance</div>
                            <div class="stat-value" id="totalBalance">$127,432.18</div>
                            <div class="stat-change positive" id="balanceChange">‚ñ≤ $9,842 YTD</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">YTD Return</div>
                            <div class="stat-value" id="ytdReturn">+8.2%</div>
                            <div class="stat-change positive" id="returnAmount">+$9,842</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Contribution Rate</div>
                            <div class="stat-value" id="contributionRate">8%</div>
                            <div class="stat-change" id="contributionAmount">$615/paycheck</div>
                        </div>
                    </div>

                    <!-- Investments -->
                    <div class="dashboard-card">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg">Your Investments</h2>
                            <button class="text-sm" style="color: #0619f5;">View All</button>
                        </div>
                        <div id="investmentsList"></div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="dashboard-card">
                        <h2 class="text-lg mb-4">Recent Activity</h2>
                        <div id="activityList"></div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <button class="nav-button active">
                <span class="nav-icon">üè†</span>
                <span>Home</span>
            </button>
            <button class="nav-button">
                <span class="nav-icon">üìä</span>
                <span>Invest</span>
            </button>
            <button class="nav-button">
                <span class="nav-icon">üìÑ</span>
                <span>Docs</span>
            </button>
            <button class="nav-button" onclick="openChatbot()">
                <span class="nav-icon">üí¨</span>
                <span>Help</span>
            </button>
        </nav>

        <!-- Floating Chat Button -->
        <button class="chat-button" onclick="openChatbot()" id="chatButton">
            üí¨
        </button>

        <!-- Chatbot Container -->
        <div class="chatbot-container" id="chatbotContainer">
            <div class="chatbot-header">
                <div class="chatbot-title">
                    <span>ü§ñ</span>
                    <span>State Street Assistant</span>
                </div>
                <button class="chatbot-close" onclick="closeChatbot()">‚úï</button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages"></div>
            <div class="chatbot-input-container">
                <div class="chatbot-input-wrapper">
                    <input type="text" class="chatbot-input" id="chatInput" placeholder="Type a message..." onkeypress="handleInputKeyPress(event)">
                    <button class="chatbot-send" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
        
        <!-- End of Demo Modal -->
        <div class="demo-end-modal" id="demoEndModal">
            <div class="demo-end-modal-content">
                <h2>You've reached the end of this demo.</h2>
                <p>Thank you for exploring the State Street Retirement Assistant. Would you like to restart the experience?</p>
                <div class="demo-end-modal-buttons">
                    <button class="demo-end-modal-button restart" onclick="restartConversation()">Restart</button>
                    <button class="demo-end-modal-button close" onclick="closeDemoEndModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // USER DATA (Gen X Persona)
        // ============================================
        const currentUser = {
            id: 'david-martinez',
            name: 'David Martinez',
            age: 48,
            initial: 'D',
            account: {
                balance: 412890.45,
                ytdContributions: 30500,
                ytdEmployerMatch: 8550,
                ytdReturn: 0.075,
                contributionRate: 0.15,
                employerMatchRate: 0.50,
                employerMatchCap: 0.06,
                vestingPercent: 1.0,
                salary: 142000,
                catchUpEligible: true,
                catchUpContribution: 7500,
            },
            investments: [
                { name: 'State Street Target 2040', ticker: 'SS2040', allocation: 0.70, ytdReturn: 0.09 },
                { name: 'State Street Stable Value', ticker: 'SSSTV', allocation: 0.20, ytdReturn: 0.035 },
                { name: 'State Street S&P 500 Index', ticker: 'SSSIX', allocation: 0.10, ytdReturn: 0.12 },
            ],
            recentActivity: [
                { date: '2025-12-01', type: 'contribution', amount: 1183 },
                { date: '2025-12-01', type: 'catchup', amount: 288 },
                { date: '2025-12-01', type: 'match', amount: 355 },
            ],
            externalAccounts: [
                { provider: 'Previous Employer 401k (Company A)', balance: 45000, lastUpdated: '2023-08-10' },
                { provider: 'Previous Employer 401k (Company B)', balance: 32000, lastUpdated: '2021-03-22' },
                { provider: 'Previous Employer 401k (Company C)', balance: 18000, lastUpdated: '2019-11-05' }
            ]
        };

        // ============================================
        // APP STATE
        // ============================================
        let chatMessages = [];
        let isTyping = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            renderDashboard();
            if (chatMessages.length === 0) {
                addAIMessage('Hello David. I\'m here to help you get clarity on your retirement planning. What would you like to know?', [
                    'Am I on track to retire at 65?',
                    'How do catch-up contributions work?',
                    'Should I consolidate my old 401(k)s?',
                    'What\'s my balance?'
                ]);
            }
        }

        // ============================================
        // DASHBOARD RENDERING
        // ============================================
        function renderDashboard() {
            const account = currentUser.account;
            
            // Update header (name is already set in HTML, just update avatar)
            document.getElementById('userAvatar').textContent = currentUser.initial;
            
            // Update stats
            document.getElementById('totalBalance').textContent = `$${account.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            const balanceChange = account.ytdContributions + account.ytdEmployerMatch + (account.balance * account.ytdReturn);
            document.getElementById('balanceChange').textContent = `‚ñ≤ $${Math.round(balanceChange).toLocaleString()} YTD`;
            
            document.getElementById('ytdReturn').textContent = `+${(account.ytdReturn * 100).toFixed(1)}%`;
            document.getElementById('returnAmount').textContent = `+$${Math.round(account.balance * account.ytdReturn).toLocaleString()}`;
            
            document.getElementById('contributionRate').textContent = `${(account.contributionRate * 100).toFixed(0)}%`;
            const perPaycheck = (account.salary * account.contributionRate) / 24;
            document.getElementById('contributionAmount').textContent = `$${Math.round(perPaycheck)}/paycheck`;
            
            // Render investments
            const investmentsList = document.getElementById('investmentsList');
            investmentsList.innerHTML = '';
            
            currentUser.investments.forEach(inv => {
                const item = document.createElement('div');
                item.className = 'investment-item';
                item.innerHTML = `
                    <div style="flex: 1;">
                        <div class="font-medium">${inv.name}</div>
                        <div class="text-sm text-gray-600">${inv.ticker}</div>
                        <div class="investment-bar">
                            <div class="investment-bar-fill" style="width: ${inv.allocation * 100}%"></div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="font-semibold">${(inv.allocation * 100).toFixed(0)}%</div>
                        <div class="text-sm text-green-600">+${(inv.ytdReturn * 100).toFixed(1)}%</div>
                    </div>
                `;
                investmentsList.appendChild(item);
            });
            
            // Render activity
            const activityList = document.getElementById('activityList');
            activityList.innerHTML = '';
            
            currentUser.recentActivity.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                const typeLabel = activity.type === 'contribution' ? 'Contribution' :
                                 activity.type === 'match' ? 'Employer Match' :
                                 activity.type === 'catchup' ? 'Catch-Up Contribution' :
                                 activity.type === 'enrollment' ? 'Enrollment' :
                                 activity.type === 'beneficiary_update' ? 'Beneficiary Update' : activity.type;
                
                const date = new Date(activity.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                item.innerHTML = `
                    <div>
                        <div class="activity-type">${typeLabel}</div>
                        <div class="activity-date">${dateStr}</div>
                    </div>
                    ${activity.amount ? `<div class="activity-amount">+$${activity.amount.toLocaleString()}</div>` : ''}
                `;
                activityList.appendChild(item);
            });
        }

        // ============================================
        // CHATBOT FUNCTIONS
        // ============================================
        function openChatbot() {
            document.getElementById('chatbotContainer').classList.add('open');
            document.getElementById('chatButton').style.display = 'none';
            // Scroll to bottom when opening chatbot
            setTimeout(() => {
                const messagesDiv = document.getElementById('chatbotMessages');
                if (messagesDiv) {
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }
            }, 100);
            document.getElementById('chatInput').focus();
        }

        function closeChatbot() {
            document.getElementById('chatbotContainer').classList.remove('open');
            document.getElementById('chatButton').style.display = 'flex';
        }

        function animateMessage(messageDiv, contentDiv, fullContent, quickReplies, onComplete) {
            let currentIndex = 0;
            const speed = 15; // milliseconds per character - matches original prototype
            let inTag = false;
            let currentTag = '';
            const messagesDiv = document.getElementById('chatbotMessages');
            
            function typeNext() {
                if (currentIndex >= fullContent.length) {
                    // Animation complete - show final content and cursor
                    contentDiv.innerHTML = fullContent.replace(/\n/g, '<br>');
                    
                    // Add quick replies if provided
                    if (quickReplies.length > 0) {
                        const repliesDiv = document.createElement('div');
                        repliesDiv.className = 'quick-replies';
                        quickReplies.forEach(reply => {
                            const btn = document.createElement('button');
                            btn.className = 'quick-reply-btn';
                            btn.textContent = reply;
                            btn.onclick = () => handleQuickReply(reply);
                            repliesDiv.appendChild(btn);
                        });
                        const contentWrapper = messageDiv.querySelector('.message-content-wrapper');
                        if (contentWrapper) {
                            contentWrapper.appendChild(repliesDiv);
                        }
                    }
                    
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    isTyping = false;
                    
                    if (onComplete) {
                        onComplete();
                    }
                    return;
                }
                
                // Handle HTML tags - don't animate them character by character
                if (fullContent[currentIndex] === '<') {
                    inTag = true;
                    currentTag = '<';
                    currentIndex++;
                    while (currentIndex < fullContent.length && fullContent[currentIndex] !== '>') {
                        currentTag += fullContent[currentIndex];
                        currentIndex++;
                    }
                    if (currentIndex < fullContent.length) {
                        currentTag += '>';
                        currentIndex++;
                    }
                    contentDiv.innerHTML = fullContent.substring(0, currentIndex).replace(/\n/g, '<br>') + '<span class="typing-cursor">|</span>';
                    inTag = false;
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    setTimeout(typeNext, speed / 3); // Faster for tags
                    return;
                }
                
                // Regular character
                currentIndex++;
                contentDiv.innerHTML = fullContent.substring(0, currentIndex).replace(/\n/g, '<br>') + '<span class="typing-cursor">|</span>';
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                setTimeout(typeNext, speed);
            }
            
            typeNext();
        }

        function addAIMessage(content, quickReplies = []) {
            if (isTyping) return;
            isTyping = true;
            
            const messagesDiv = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';
            
            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'message-content-wrapper';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = '<span class="typing-cursor">|</span>';
            contentWrapper.appendChild(contentDiv);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentWrapper);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Start animation after a brief delay
            setTimeout(() => {
                animateMessage(messageDiv, contentDiv, content, quickReplies);
            }, 300);
        }

        function addUserMessage(content) {
            const messagesDiv = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = currentUser.initial;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function handleQuickReply(reply) {
            addUserMessage(reply);
            handleConversation(reply);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message || isTyping) return;
            
            input.value = '';
            addUserMessage(message);
            handleConversation(message);
        }

        function handleInputKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ============================================
        // CONVERSATION HANDLING
        // ============================================
        function showDemoEndModal() {
            document.getElementById('demoEndModal').classList.add('open');
        }
        
        function closeDemoEndModal() {
            document.getElementById('demoEndModal').classList.remove('open');
        }
        
        function restartConversation() {
            closeDemoEndModal();
            chatMessages = [];
            document.getElementById('chatbotMessages').innerHTML = '';
            init(); // Restart conversation
        }

        function handleConversation(message) {
            const lowerMsg = message.toLowerCase();
            const account = currentUser.account;
            
            // Track whether we successfully handled this message
            let messageHandled = false;
            
            // Show typing indicator
            const messagesDiv = document.getElementById('chatbotMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            setTimeout(() => {
                document.getElementById('typingIndicator').remove();
                
                // View breakdown (detailed balance breakdown) - check FIRST before balance
                if (lowerMsg.includes('view breakdown') || (lowerMsg.includes('breakdown') && !lowerMsg.includes('contribution') && !lowerMsg.includes('allocation'))) {
                    messageHandled = true;
                    const ytdGrowth = account.balance * account.ytdReturn;
                    const accountEarnings = account.balance - account.ytdContributions - account.ytdEmployerMatch;
                    const totalYtdContributions = account.ytdContributions + account.ytdEmployerMatch;
                    
                    const response = `Here's a detailed breakdown of your account balance:\n\nüìä <b>Account Balance: $${account.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</b>\n\n<b>Year-to-Date Activity:</b>\n‚Ä¢ Your contributions: $${account.ytdContributions.toLocaleString()}\n‚Ä¢ Employer match: $${account.ytdEmployerMatch.toLocaleString()}\n‚Ä¢ Total contributions YTD: $${totalYtdContributions.toLocaleString()}\n‚Ä¢ Investment returns YTD: $${Math.round(ytdGrowth).toLocaleString()} (${(account.ytdReturn * 100).toFixed(1)}%)\n\n<b>Current Contribution Strategy:</b>\n‚Ä¢ Regular contribution: ${(account.contributionRate * 100).toFixed(0)}% of salary ($${Math.round((account.salary * account.contributionRate) / 24).toLocaleString()}/paycheck)\n‚Ä¢ Catch-up contribution: $${account.catchUpContribution.toLocaleString()}/year\n‚Ä¢ Employer match: ${(account.employerMatchRate * 100).toFixed(0)}% up to ${(account.employerMatchCap * 100).toFixed(0)}% (you're maximizing this ‚úì)\n‚Ä¢ Total annual contributions: ~$${Math.round(account.ytdContributions + account.ytdEmployerMatch + account.catchUpContribution).toLocaleString()}\n\nThis gives you a clear picture of where your savings stand. Would you like to see how this compares to your retirement goals?`;
                    addAIMessage(response, ['Am I on track to retire at 65?', 'Run a projection', 'Should I consolidate my old 401(k)s?', 'What else?']);
                }
                // Balance inquiry (Gen X tone: reassuring, clear)
                else if (lowerMsg.includes('balance') || lowerMsg.includes('how much')) {
                    const response = `Your current balance is $${account.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}.\n\nThis includes your regular contributions and the $${account.catchUpContribution.toLocaleString()} catch-up contribution you're making this year. Your account is up ${(account.ytdReturn * 100).toFixed(1)}% year-to-date.\n\nWould you like a detailed breakdown or to check if you're on track for retirement?`;
                    addAIMessage(response, ['Am I on track to retire at 65?', 'View breakdown', 'How do catch-up contributions work?', 'What else?']);
                }
                // Contribution rate percentage selection (handle before contribution change question)
                else if (lowerMsg.match(/^\d+%$/) || lowerMsg.match(/^\d+\.?\d*%$/)) {
                    messageHandled = true;
                    // Extract the percentage number
                    const rateMatch = lowerMsg.match(/(\d+\.?\d*)/);
                    if (rateMatch) {
                        const newRate = parseFloat(rateMatch[1]) / 100;
                        const currentRate = (account.contributionRate * 100).toFixed(0);
                        const currentPerPaycheck = (account.salary * account.contributionRate) / 24;
                        const newPerPaycheck = (account.salary * newRate) / 24;
                        const changePerPaycheck = newPerPaycheck - currentPerPaycheck;
                        const newAnnual = account.salary * newRate;
                        const currentAnnual = account.salary * account.contributionRate;
                        
                        const response = `Perfect! I'll update your contribution rate to ${rateMatch[1]}%.\n\nüìã Change Summary:\n‚Ä¢ Current: ${currentRate}% ($${Math.round(currentPerPaycheck)}/paycheck = $${Math.round(currentAnnual).toLocaleString()}/year)\n‚Ä¢ New: ${rateMatch[1]}% ($${Math.round(newPerPaycheck)}/paycheck = $${Math.round(newAnnual).toLocaleString()}/year)\n‚Ä¢ Change: ${changePerPaycheck >= 0 ? '+' : ''}$${Math.round(changePerPaycheck)}/paycheck\n\nThis change will take effect on your next pay period.\n\nReady to confirm this change?`;
                        addAIMessage(response, ['Confirm change', 'Cancel', 'Change the amount']);
                    }
                }
                // Change the amount (return to contribution rate selection)
                else if (lowerMsg.includes('change') && (lowerMsg.includes('amount') || lowerMsg.includes('the amount'))) {
                    messageHandled = true;
                    const currentRate = (account.contributionRate * 100).toFixed(0);
                    const perPaycheck = (account.salary * account.contributionRate) / 24;
                    const response = `No problem. Let's adjust your contribution rate.\n\nüìã Current setup:\n‚Ä¢ Your contribution: ${currentRate}% ($${Math.round(perPaycheck)}/paycheck)\n‚Ä¢ Employer match: ${(account.employerMatchRate * 100).toFixed(0)}% up to ${(account.employerMatchCap * 100).toFixed(0)}% (you're maximizing this ‚úì)\n\nWhat would you like your new contribution rate to be?`;
                    addAIMessage(response, ['10%', '12%', '15%', 'Enter custom %']);
                }
                // Contribution change
                else if ((lowerMsg.includes('contribution') && lowerMsg.includes('change')) || (lowerMsg.includes('change') && lowerMsg.includes('rate') && !lowerMsg.includes('amount'))) {
                    messageHandled = true;
                    const currentRate = (account.contributionRate * 100).toFixed(0);
                    const perPaycheck = (account.salary * account.contributionRate) / 24;
                    const response = `I can help you change your contribution rate.\n\nüìã Current setup:\n‚Ä¢ Your contribution: ${currentRate}% ($${Math.round(perPaycheck)}/paycheck)\n‚Ä¢ Employer match: ${(account.employerMatchRate * 100).toFixed(0)}% up to ${(account.employerMatchCap * 100).toFixed(0)}% (you're maximizing this ‚úì)\n\nWhat would you like your new contribution rate to be?`;
                    addAIMessage(response, ['10%', '12%', '15%', 'Enter custom %']);
                }
                // Gen X: Run a projection (provides clarity on "am I doing this right")
                else if (lowerMsg.includes('run a projection') || lowerMsg.includes('projection') || (lowerMsg.includes('yes') && chatMessages[chatMessages.length - 1] && chatMessages[chatMessages.length - 1].content && chatMessages[chatMessages.length - 1].content.includes('run a projection'))) {
                    messageHandled = true;
                    // Calculate retirement projection
                    const currentAge = currentUser.age;
                    const retirementAge = 65;
                    const yearsToRetirement = retirementAge - currentAge;
                    const currentBalance = account.balance;
                    const annualContribution = account.salary * account.contributionRate;
                    const annualCatchUp = account.catchUpContribution;
                    const annualMatch = Math.min(account.salary * account.contributionRate, account.salary * account.employerMatchCap) * account.employerMatchRate;
                    const totalAnnualContribution = annualContribution + annualCatchUp + annualMatch;
                    const assumedReturn = 0.06; // 6% annual return
                    
                    // Future value calculation with compound growth
                    let projectedBalance = currentBalance;
                    let totalContributions = 0;
                    for (let year = 0; year < yearsToRetirement; year++) {
                        projectedBalance = projectedBalance * (1 + assumedReturn);
                        projectedBalance += totalAnnualContribution;
                        totalContributions += totalAnnualContribution;
                    }
                    
                    // Also calculate with consolidation scenario
                    const totalOldAccounts = currentUser.externalAccounts.reduce((sum, acc) => sum + acc.balance, 0);
                    const consolidatedBalance = currentBalance + totalOldAccounts;
                    let consolidatedProjected = consolidatedBalance;
                    for (let year = 0; year < yearsToRetirement; year++) {
                        consolidatedProjected = consolidatedProjected * (1 + assumedReturn);
                        consolidatedProjected += totalAnnualContribution;
                    }
                    
                    const growth = projectedBalance - currentBalance - totalContributions;
                    
                    const response = `Here's your retirement projection to help answer "am I doing this right?":\n\nüìä <b>Current Strategy</b> (Age ${currentAge} ‚Üí 65, ${yearsToRetirement} years):\n‚Ä¢ Starting balance: $${currentBalance.toLocaleString()}\n‚Ä¢ Annual contributions: $${Math.round(totalAnnualContribution).toLocaleString()} (your $${Math.round(annualContribution).toLocaleString()} + catch-up $${annualCatchUp.toLocaleString()} + match $${Math.round(annualMatch).toLocaleString()})\n‚Ä¢ Total you'll contribute: $${Math.round(totalContributions).toLocaleString()}\n‚Ä¢ Projected investment growth: $${Math.round(growth).toLocaleString()}\n‚Ä¢ <b>Projected balance at 65: ~$${Math.round(projectedBalance).toLocaleString()}</b>\n\nüí° <b>If You Consolidate</b> (roll over your three old 401(k)s totaling $${totalOldAccounts.toLocaleString()}):\n‚Ä¢ Starting balance: $${consolidatedBalance.toLocaleString()}\n‚Ä¢ <b>Projected balance at 65: ~$${Math.round(consolidatedProjected).toLocaleString()}</b>\n‚Ä¢ Additional value: ~$${Math.round(consolidatedProjected - projectedBalance).toLocaleString()}\n\n*Assumes 6% average annual return. This is a projection‚Äîactual results will vary based on market performance.*\n\nThis gives you a clearer picture. Would you like to explore different contribution scenarios or discuss consolidating your old accounts?`;
                    addAIMessage(response, ['Show me different contribution scenarios', 'Should I consolidate my old 401(k)s?', 'What else can I do?', 'Talk to an advisor']);
                }
                // Gen X: Am I on track? (acknowledges anxiety, provides clarity)
                else if (lowerMsg.includes('on track') || (lowerMsg.includes('track') && (lowerMsg.includes('retirement') || lowerMsg.includes('65')))) {
                    messageHandled = true;
                    const retirementAge = 65;
                    const yearsToRetirement = retirementAge - currentUser.age;
                    const response = `I understand you want clarity on whether you're on track. Let me give you an honest assessment.\n\nWith your current balance of $${account.balance.toLocaleString()} and ${yearsToRetirement} years until age 65, here's what I see:\n\n<b>What you're doing well:</b>\n‚Ä¢ You're maximizing catch-up contributions ($${account.catchUpContribution.toLocaleString()}/year) ‚úì\n‚Ä¢ Contributing 15% annually is above the typical 10-15% recommendation\n‚Ä¢ Your portfolio allocation is appropriate for your age\n\n<b>To give you a personalized answer</b>, I'd need to run a projection based on your specific retirement goals and expenses. Would you like me to do that now?`;
                    addAIMessage(response, ['Yes, run a projection', 'Should I consolidate my old 401(k)s?', 'How do catch-up contributions work?', 'Talk to an advisor']);
                }
                // Gen X: Catch-up contributions (explains clearly, addresses "are they worth it")
                else if (lowerMsg.includes('catch') || lowerMsg.includes('catch-up') || lowerMsg.includes('catchup')) {
                    messageHandled = true;
                    const totalOldAccounts = currentUser.externalAccounts.reduce((sum, acc) => sum + acc.balance, 0);
                    const response = `Since you're 50 or older, you can contribute an extra $7,500 per year on top of the regular $23,000 limit.\n\nüìä <b>Your current setup:</b>\n‚Ä¢ Regular contribution: $23,000/year (maxed ‚úì)\n‚Ä¢ Catch-up contribution: $${account.catchUpContribution.toLocaleString()}/year (maxed ‚úì)\n\n<b>Are they worth it?</b> Absolutely. This extra $${account.catchUpContribution.toLocaleString()} each year gets the same tax benefits and has ${65 - currentUser.age} years to grow before retirement. At a 6% return, that's roughly an extra $${Math.round(account.catchUpContribution * 18).toLocaleString()} toward your retirement.\n\n<b>I also notice you have three old 401(k) accounts</b> totaling about $${totalOldAccounts.toLocaleString()}. Consolidating them here could simplify your planning and give you better oversight. Want to explore that?`;
                    addAIMessage(response, ['Should I consolidate my old 401(k)s?', 'What are the benefits of consolidation?', 'Tell me more about catch-ups', 'What else?']);
                }
                // Gen X: Different contribution scenarios
                else if (lowerMsg.includes('different contribution') || lowerMsg.includes('scenarios')) {
                    messageHandled = true;
                    const currentAge = currentUser.age;
                    const retirementAge = 65;
                    const yearsToRetirement = retirementAge - currentAge;
                    const currentBalance = account.balance;
                    const currentRate = account.contributionRate;
                    const assumedReturn = 0.06;
                    const annualCatchUp = account.catchUpContribution;
                    
                    // Calculate scenarios: current (15%), increase to 18%, decrease to 12%
                    const scenarios = [
                        { rate: currentRate, label: `Current (${(currentRate * 100).toFixed(0)}%)` },
                        { rate: 0.18, label: 'Increase to 18%' },
                        { rate: 0.12, label: 'Decrease to 12%' }
                    ];
                    
                    // Calculate current scenario first to use as baseline
                    const currentAnnualContribution = account.salary * currentRate;
                    const currentAnnualMatch = Math.min(account.salary * currentRate, account.salary * account.employerMatchCap) * account.employerMatchRate;
                    const currentTotalAnnual = currentAnnualContribution + annualCatchUp + currentAnnualMatch;
                    
                    let currentProjected = currentBalance;
                    for (let year = 0; year < yearsToRetirement; year++) {
                        currentProjected = currentProjected * (1 + assumedReturn);
                        currentProjected += currentTotalAnnual;
                    }
                    
                    let response = `Here are different contribution scenarios for your retirement:\n\n`;
                    
                    scenarios.forEach(scenario => {
                        const annualContribution = account.salary * scenario.rate;
                        const annualMatch = Math.min(account.salary * scenario.rate, account.salary * account.employerMatchCap) * account.employerMatchRate;
                        const totalAnnual = annualContribution + annualCatchUp + annualMatch;
                        
                        let projected = currentBalance;
                        for (let year = 0; year < yearsToRetirement; year++) {
                            projected = projected * (1 + assumedReturn);
                            projected += totalAnnual;
                        }
                        
                        let diffLabel = '';
                        if (scenario.rate !== currentRate) {
                            const difference = projected - currentProjected;
                            diffLabel = difference > 0 ? ` (+$${Math.round(difference).toLocaleString()} vs current)` : ` (-$${Math.abs(Math.round(difference)).toLocaleString()} vs current)`;
                        }
                        
                        response += `<b>${scenario.label}</b>:\n‚Ä¢ Annual contribution: $${Math.round(totalAnnual).toLocaleString()}\n‚Ä¢ Projected at 65: ~$${Math.round(projected).toLocaleString()}${diffLabel}\n\n`;
                    });
                    
                    response += `*Assumes 6% average annual return. Actual results will vary.*\n\nWould you like to change your contribution rate or explore other options?`;
                    addAIMessage(response, ['Change my contribution rate', 'Tell me about consolidation', 'What else?', 'Talk to an advisor']);
                }
                // Gen X: Account consolidation (addresses multiple old 401ks, provides clear guidance)
                else if (lowerMsg.includes('consolidat') || lowerMsg.includes('old 401k') || lowerMsg.includes('old account') || lowerMsg.includes('previous 401')) {
                    messageHandled = true;
                    const totalOldAccounts = currentUser.externalAccounts.reduce((sum, acc) => sum + acc.balance, 0);
                    const consolidatedBalance = account.balance + totalOldAccounts;
                    
                    let accountsList = '';
                    currentUser.externalAccounts.forEach((acc, idx) => {
                        accountsList += `‚Ä¢ ${acc.provider}: $${acc.balance.toLocaleString()} (last updated ${acc.lastUpdated})\n`;
                    });
                    
                    const response = `I see you have <b>three old 401(k) accounts</b> from previous employers. Here's what you're working with:\n\n${accountsList}<b>Total in old accounts: $${totalOldAccounts.toLocaleString()}</b>\n\n<b>Benefits of consolidating into this account:</b>\n‚Ä¢ <b>Simplified management</b> - One account instead of four to track\n‚Ä¢ <b>Better oversight</b> - See your complete retirement picture in one place\n‚Ä¢ <b>Lower fees</b> - Our plan's expense ratios are competitive\n‚Ä¢ <b>Investment control</b> - Access to our full range of funds\n‚Ä¢ <b>Easier planning</b> - One account makes projections and planning clearer\n\nRolling them all over would bring your total balance here to about <b>$${consolidatedBalance.toLocaleString()}</b>.\n\n<b>Important:</b> There are no tax penalties for rolling over 401(k) to 401(k). The money stays tax-deferred.\n\nWould you like me to walk you through the rollover process, or do you have questions about the tax implications?`;
                    addAIMessage(response, ['Walk me through the rollover', 'What are the tax implications?', 'Talk to a specialist', 'Not right now']);
                }
                // Escalation
                else if (lowerMsg.includes('human') || lowerMsg.includes('agent') || lowerMsg.includes('representative') || lowerMsg.includes('talk to')) {
                    messageHandled = true;
                    const response = `Of course. I'll connect you with a retirement specialist who can help.\n\nüìã I'll share our conversation so you won't need to repeat anything.\n\n‚è±Ô∏è Estimated wait: 2-3 minutes\n\nHow would you like to proceed?`;
                    addAIMessage(response, ['Connect now', 'Schedule callback', 'Keep chatting for now']);
                }
                // Investments (Gen X: detailed, solution-oriented)
                else if (lowerMsg.includes('invest') || lowerMsg.includes('fund') || lowerMsg.includes('allocation')) {
                    messageHandled = true;
                    let response = `Here's your current investment allocation:\n\n`;
                    currentUser.investments.forEach(inv => {
                        response += `‚Ä¢ ${inv.name} (${inv.ticker}): ${(inv.allocation * 100).toFixed(0)}% allocation - ${(inv.ytdReturn * 100).toFixed(1)}% YTD return\n`;
                    });
                    response += `\nYour portfolio is well-diversified with a mix of target-date funds, stable value, and growth-oriented investments. This is appropriate for someone in your age range. Would you like to discuss rebalancing or explore other investment options?`;
                    addAIMessage(response, ['Rebalance my portfolio', 'What other options do I have?', 'Tell me about fees', 'What else?']);
                }
                // Confirm change
                else if (lowerMsg.includes('confirm') && lowerMsg.includes('change')) {
                    messageHandled = true;
                    const response = `‚úì Your contribution rate change has been confirmed!\n\nYou'll see the new rate reflected starting with your next pay period. A confirmation email has been sent to your registered email address.\n\nIs there anything else I can help you with?`;
                    addAIMessage(response, [
                        'What\'s my balance?',
                        'View investments',
                        'Talk to a human'
                    ]);
                }
                // Cancel change
                else if (lowerMsg.includes('cancel')) {
                    messageHandled = true;
                    const response = `No problem. Your contribution rate remains unchanged.\n\nWhat else can I help you with?`;
                    addAIMessage(response, [
                        'What\'s my balance?',
                        'Change contribution',
                        'View investments',
                        'Talk to a human'
                    ]);
                }
                // Reset conversation handlers - show end of demo modal
                else if (lowerMsg.includes('keep chatting for now') || 
                         lowerMsg.includes('connect now') || 
                         lowerMsg.includes('rebalance my portfolio') ||
                         lowerMsg.includes('schedule callback') || 
                         lowerMsg.includes('walk me through') ||
                         lowerMsg.includes('what other options') || 
                         lowerMsg.includes('other options')) {
                    messageHandled = true;
                    showDemoEndModal();
                    return;
                }
                // Default - unhandled reply, show end of demo modal
                else {
                    if (!messageHandled) {
                        showDemoEndModal();
                        return;
                    }
                }
                
                // Always scroll to bottom after adding message
                setTimeout(() => {
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }, 100);
            }, 1000);
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>

